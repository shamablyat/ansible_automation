---
- name: Install Zabbix Agent dependencies
  apt:
    name:
      - wget
      - lsb-release
    state: present

- name: Add Zabbix repository
  apt_repository:
    repo: "deb http://repo.zabbix.com/zabbix/6.0/ubuntu $(lsb_release -c | awk '{print $2}') main"
    state: present

- name: Install Zabbix Agent
  apt:
    name: zabbix-agent
    state: present
    update_cache: yes

- name: Configure Zabbix Agent configuration file
  template:
    src: zabbix_agentd.conf.j2
    dest: /etc/zabbix/zabbix_agentd.conf
  notify:
    - Restart Zabbix Agent

- name: Start and enable Zabbix Agent service
  service:
    name: zabbix-agent
    state: started
    enabled: yes
